{"version":3,"sources":["src/server.js"],"names":["path","App","Error","Html","basename","host","port","express","React","renderToStaticMarkup","Provider","StaticRouter","renderToString","serialize","configureStore","ServerStyleSheet","renderApp","store","context","location","sheet","app","collectStyles","renderHtml","serverState","initialState","content","styles","getStyleElement","global","assets","state","props","html","use","static","resolve","process","cwd","req","res","next","url","then","status","redirect","getState","send","catch","err","console","error","listen","boldBlue","text","info"],"mappings":"AAAA;AACA,OAAO,gBAAP;;AAEA,OAAOA,IAAP,MAAiB,MAAjB;;AAEA,OAAOC,GAAP,MAAgB,gBAAhB;AACA,OAAOC,KAAP,MAAkB,kBAAlB;AACA,OAAOC,IAAP,MAAiB,iBAAjB;AACA,SAASC,QAAT,EAAmBC,IAAnB,EAAyBC,IAAzB,QAAqC,QAArC;AACA,OAAOC,OAAP,MAAoB,SAApB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,SAASC,oBAAT,QAAqC,kBAArC;AACA,SAASC,QAAT,QAAyB,aAAzB;AACA,SAASC,YAAT,QAA6B,cAA7B;AACA,SAASC,cAAT,QAA+B,qBAA/B;AACA,OAAOC,SAAP,MAAsB,sBAAtB;AACA,OAAOC,cAAP,MAA2B,iBAA3B;AACA,SAASC,gBAAT,QAAiC,mBAAjC;;AAEA,IAAMC,YAAY,SAAZA,SAAY,OAAyC;AAAA,MAAtCC,KAAsC,QAAtCA,KAAsC;AAAA,MAA/BC,OAA+B,QAA/BA,OAA+B;AAAA,MAAtBC,QAAsB,QAAtBA,QAAsB;AAAA,MAAZC,KAAY,QAAZA,KAAY;;AACzD,MAAMC,MAAMD,MAAME,aAAN,CACV;AAAC,YAAD;AAAA,MAAU,OAAOL,KAAjB;AACE;AAAC,kBAAD;AAAA,QAAc,UAAUb,QAAxB,EAAkC,SAASc,OAA3C,EAAoD,UAAUC,QAA9D;AACE,0BAAC,GAAD;AADF;AADF,GADU,CAAZ;AAOA,SAAOP,eAAeS,GAAf,CAAP;AACD,CATD;;AAWA,IAAME,aAAa,SAAbA,UAAa,QAAmD;AAAA,MAAhDC,WAAgD,SAAhDA,WAAgD;AAAA,MAAnCC,YAAmC,SAAnCA,YAAmC;AAAA,MAArBC,OAAqB,SAArBA,OAAqB;AAAA,MAAZN,KAAY,SAAZA,KAAY;;AACpE,MAAMO,SAASP,MAAMQ,eAAN,EAAf;AADoE,gBAEjDC,MAFiD;AAAA,MAE5DC,MAF4D,WAE5DA,MAF4D;;AAGpE,MAAMC,6CACwBlB,UAAUW,WAAV,CADxB,0CAEyBX,UAAUY,YAAV,CAFzB,UAAN;AAIA,MAAMO,QAAQ;AACZL,kBADY;AAEZG,kBAFY;AAGZC,gBAHY;AAIZL;AAJY,GAAd;AAMA,MAAMO,OAAO,oBAAC,IAAD,EAAUD,KAAV,CAAb;AACA,+BAA2BvB,qBAAqBwB,IAArB,CAA3B;AACD,CAfD;;AAiBA,IAAMZ,MAAMd,SAAZ;;AAEAc,IAAIa,GAAJ,CAAQ9B,QAAR,EAAkBG,QAAQ4B,MAAR,CAAenC,KAAKoC,OAAL,CAAaC,QAAQC,GAAR,EAAb,EAA4B,aAA5B,CAAf,CAAlB;;AAEAjB,IAAIa,GAAJ,CAAQ,UAACK,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAC1B,MAAMtB,WAAWoB,IAAIG,GAArB;AACA,MAAMzB,QAAQH,eAAe,EAAf,CAAd;AACA,MAAMI,UAAU,EAAhB;AACA,MAAME,QAAQ,IAAIL,gBAAJ,EAAd;;AAEAC,YAAU;AACRC,gBADQ;AAERC,oBAFQ;AAGRC,sBAHQ;AAIRC;AAJQ,GAAV,EAMGuB,IANH,CAMQ,iBAA2C;AAAA,QAAjCnB,WAAiC,SAAxCO,KAAwC;AAAA,QAAdL,OAAc,SAApBO,IAAoB;;AAC/C,QAAIf,QAAQ0B,MAAZ,EAAoB;AAClBJ,UAAII,MAAJ,CAAW1B,QAAQ0B,MAAnB;AACD;AACD,QAAI1B,QAAQwB,GAAZ,EAAiB;AACfF,UAAIK,QAAJ,CAAa3B,QAAQwB,GAArB;AACD,KAFD,MAEO;AACL,UAAMjB,eAAeR,MAAM6B,QAAN,EAArB;AACAN,UAAIO,IAAJ,CACExB,WAAW;AACTC,gCADS;AAETC,kCAFS;AAGTC,wBAHS;AAITN;AAJS,OAAX,CADF;AAQD;AACF,GAvBH,EAwBG4B,KAxBH,CAwBSP,IAxBT;AAyBD,CA/BD;;AAiCApB,IAAIa,GAAJ,CAAQ,UAACe,GAAD,EAAMV,GAAN,EAAWC,GAAX,EAAgBC,IAAhB,EAAyB;AAC/B,MAAMrB,QAAQ,IAAIL,gBAAJ,EAAd;AACA,MAAMW,UAAUjB,qBAAqBW,MAAME,aAAN,CAAoB,oBAAC,KAAD,OAApB,CAArB,CAAhB;AACAkB,MAAII,MAAJ,CAAW,GAAX,EAAgBG,IAAhB,CAAqBxB,WAAW,EAAEG,gBAAF,EAAWN,YAAX,EAAX,CAArB;AACA8B,UAAQC,KAAR,CAAcF,GAAd;AACAR,OAAKQ,GAAL;AACD,CAND;;AAQA5B,IAAI+B,MAAJ,CAAW9C,IAAX,EAAiB,iBAAS;AACxB,MAAM+C,WAAW,SAAXA,QAAW;AAAA,+BAA8BC,IAA9B;AAAA,GAAjB;AACA,MAAIH,KAAJ,EAAW;AACTD,YAAQC,KAAR,CAAcA,KAAd;AACD,GAFD,MAEO;AACLD,YAAQK,IAAR,2BAC0BF,qBAAmBhD,IAAnB,SAA2BC,IAA3B,GAAkCF,QAAlC,OAD1B;AAGD;AACF,CATD;;;;;;;;gCAzEMY,S;;gCAWAO,U;;gCAiBAF,G","file":"server.js","sourceRoot":"/home/ryan/dev/port","sourcesContent":["/* eslint-disable no-console */\nimport 'babel-polyfill'\n\nimport path from 'path'\n\nimport App from 'components/App'\nimport Error from 'components/Error'\nimport Html from 'components/Html'\nimport { basename, host, port } from 'config'\nimport express from 'express'\nimport React from 'react'\nimport { renderToStaticMarkup } from 'react-dom/server'\nimport { Provider } from 'react-redux'\nimport { StaticRouter } from 'react-router'\nimport { renderToString } from 'react-router-server'\nimport serialize from 'serialize-javascript'\nimport configureStore from 'store/configure'\nimport { ServerStyleSheet } from 'styled-components'\n\nconst renderApp = ({ store, context, location, sheet }) => {\n  const app = sheet.collectStyles(\n    <Provider store={store}>\n      <StaticRouter basename={basename} context={context} location={location}>\n        <App />\n      </StaticRouter>\n    </Provider>,\n  )\n  return renderToString(app)\n}\n\nconst renderHtml = ({ serverState, initialState, content, sheet }) => {\n  const styles = sheet.getStyleElement()\n  const { assets } = global\n  const state = `\n    window.__SERVER_STATE__ = ${serialize(serverState)};\n    window.__INITIAL_STATE__ = ${serialize(initialState)};\n  `\n  const props = {\n    styles,\n    assets,\n    state,\n    content,\n  }\n  const html = <Html {...props} />\n  return `<!doctype html>\\n${renderToStaticMarkup(html)}`\n}\n\nconst app = express()\n\napp.use(basename, express.static(path.resolve(process.cwd(), 'dist/public')))\n\napp.use((req, res, next) => {\n  const location = req.url\n  const store = configureStore({})\n  const context = {}\n  const sheet = new ServerStyleSheet()\n\n  renderApp({\n    store,\n    context,\n    location,\n    sheet,\n  })\n    .then(({ state: serverState, html: content }) => {\n      if (context.status) {\n        res.status(context.status)\n      }\n      if (context.url) {\n        res.redirect(context.url)\n      } else {\n        const initialState = store.getState()\n        res.send(\n          renderHtml({\n            serverState,\n            initialState,\n            content,\n            sheet,\n          }),\n        )\n      }\n    })\n    .catch(next)\n})\n\napp.use((err, req, res, next) => {\n  const sheet = new ServerStyleSheet()\n  const content = renderToStaticMarkup(sheet.collectStyles(<Error />))\n  res.status(500).send(renderHtml({ content, sheet }))\n  console.error(err)\n  next(err)\n})\n\napp.listen(port, error => {\n  const boldBlue = text => `\\u001b[1m\\u001b[34m${text}\\u001b[39m\\u001b[22m`\n  if (error) {\n    console.error(error)\n  } else {\n    console.info(\n      `Server is running at ${boldBlue(`http://${host}:${port}${basename}/`)}`,\n    )\n  }\n})\n"]}